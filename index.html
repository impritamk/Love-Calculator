// Google Apps Script - Save FLAMES Results to Google Sheets

function doPost(e) {
  try {
    // Parse incoming data
    const data = JSON.parse(e.postData.contents);
    
    // Open your spreadsheet (or create new one)
    const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    let sheet = spreadsheet.getSheetByName('FLAMES Results');
    
    // Create sheet if it doesn't exist
    if (!sheet) {
      sheet = spreadsheet.insertSheet('FLAMES Results');
      // Add headers
      sheet.appendRow(['Timestamp', 'Name 1', 'Name 2', 'Relationship', 'Percentage']);
      sheet.getRange('A1:E1').setFontWeight('bold');
    }
    
    // Add data to sheet
    sheet.appendRow([
      new Date().toLocaleString(),
      data.name1,
      data.name2,
      data.relationship,
      data.percentage
    ]);
    
    // Return success
    return ContentService
      .createTextOutput(JSON.stringify({
        success: true,
        message: 'Data saved successfully'
      }))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({
        success: false,
        message: error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet() {
  return ContentService
    .createTextOutput(JSON.stringify({
      success: true,
      message: 'FLAMES API is working!'
    }))
    .setMimeType(ContentService.MimeType.JSON);
}
